@echo off
chcp 65001 > nul
echo.
echo ??????????????????????????????????????????????????????????????????????????
echo ?       Einsatzüberwachung - Netzwerk-Server mit QR-Code-Zugriff       ?
echo ??????????????????????????????????????????????????????????????????????????
echo.
echo [INFO] Server wird für Netzwerk-Zugriff gestartet...
echo.
echo ??????????????????????????????????????????????????????????????????????
echo ? ZUGRIFF AUF MOBILE DASHBOARD:                                      ?
echo ??????????????????????????????????????????????????????????????????????
echo ? 1. Server starten                                                  ?
echo ? 2. Im Browser öffnen: http://localhost:5000/mobile/connect        ?
echo ? 3. QR-Code mit Smartphone/Tablet scannen                          ?
echo ? 4. Mobile Dashboard öffnet sich automatisch                       ?
echo ??????????????????????????????????????????????????????????????????????
echo.

REM Prüfe .NET SDK
dotnet --version >nul 2>&1
if %errorlevel% neq 0 (
    echo [FEHLER] .NET 8 SDK ist nicht installiert!
    echo.
    echo Bitte installieren Sie .NET 8 SDK von:
    echo https://dotnet.microsoft.com/download/dotnet/8.0
    echo.
    pause
    exit /b 1
)

echo [?] .NET SDK gefunden
echo.

REM Wechsle ins Projektverzeichnis
cd /d "%~dp0Einsatzueberwachung.Web"

REM Ermittle lokale IP-Adresse
echo [INFO] Ermittle Netzwerk-IP-Adresse...
for /f "tokens=2 delims=:" %%a in ('ipconfig ^| findstr /c:"IPv4"') do (
    set IP=%%a
    set IP=!IP:~1!
    echo [INFO] Verfügbare IP: !IP!
)

echo.
echo ??????????????????????????????????????????????????????????????????????
echo ? SERVER-ADRESSEN:                                                   ?
echo ??????????????????????????????????????????????????????????????????????
echo ? Lokal (Desktop):  http://localhost:5000                          ?
echo ? QR-Code Seite:    http://localhost:5000/mobile/connect           ?
echo ? Mobile Dashboard: http://localhost:5000/mobile                    ?
echo ?                                                                    ?
echo ? Netzwerk-Zugriff: http://[IHRE-IP]:5000                          ?
echo ? (IP-Adressen werden im QR-Code-Fenster angezeigt)                ?
echo ??????????????????????????????????????????????????????????????????????
echo.

REM Firewall-Hinweis
echo [WICHTIG] Firewall-Regel wird benötigt!
echo.
echo Wenn Verbindung fehlschlägt, führen Sie als Administrator aus:
echo   New-NetFirewallRule -DisplayName "Einsatzueberwachung" ^
echo       -Direction Inbound -LocalPort 5000 -Protocol TCP -Action Allow
echo.

echo ????????????????????????????????????????????????????????????????????
echo  Server startet jetzt...
echo  Zum Beenden: Strg+C drücken
echo ????????????????????????????????????????????????????????????????????
echo.

REM Starte Server auf allen Interfaces
dotnet run --urls "http://0.0.0.0:5000;https://0.0.0.0:5001"

pause
